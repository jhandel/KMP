# 8.2 Deployment Repository Specification

This document defines the GitHub Releases contract consumed by KMP's in-app updater.

## Repository requirements

- Publish application updates as GitHub Releases in a single repository.
- Attach an installable package asset to each release (the updater uses the first release asset URL when present).
- If no assets are attached, the updater falls back to GitHub's generated source archive URL.

## Release-train tags

KMP uses AppSetting `Updater.Channel` as the release-train selector and matches release tags using these rules:

- Supported channels: `stable`, `beta`, `dev`, `nightly`
- Exact channel match: `<channel>`
- Prefix match: `<channel>/...`, `<channel>-...`, or `<channel>_...`
- For `stable`, plain semver tags like `v25.11.05` also match

Examples:

- `stable`: `v25.11.05`, `stable/v25.11.05`
- `beta`: `beta/v25.11.06-rc.1`, `beta-25.11.06-rc.1`

## KMP configuration

Set the GitHub source in `app.php` (or override in `app_local.php`):

```php
'Updater' => [
    'githubRepository' => 'Ansteorra/KMP-deployment',
]
```

Set the update-check channel via AppSetting `Updater.Channel` (default: `stable`).

## Installed release identity (hash/tag)

To enable reliable "you are on this release" checks, package builds should include:

- `app/config/release_hash.txt` - the build/source hash (typically git commit SHA)
- `app/config/release_tag.txt` - the release tag (for example `nightly/v1.4.2`)

The updater compares installed identity against the latest release identity (`target_commitish` hash when available, otherwise tag fallback) to report whether the installation matches the latest release.
